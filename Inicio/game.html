<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="./style.css">
    <link rel="icon" type="imagem/png" href="images/icone.png"/>

    <script src="./javascript/script_cad.js" defer></script>

    <title>4 em linha</title>
</head>

<body>
    <div id="div1">
        <audio src="win.wav"></audio>
        <div id="title"><H1>4 EM LINHA</H1></div>
        <div id="helper" style="margin-left: 100px"></div>
        <div id="screen"></div>
        <div id="bloco">
            <div id="popup"></div>
        </div>
        <div><h1 style="margin-left: 220px; margin-top: 40px;">Vez do jogador X | Criar função</h1></div>
        <div><h1 style="margin-left: 280px; margin-top: 20px;">Tempo | Criar função</h1></div>
    </div>
    <div id="div2">
        <div>
            <span class="login__icons_cad">
                <button type="button" id="button_game_back" onclick="location.href='saguao.html'">
                    Voltar para o saguão
                </button>
        </div>
        <div>
            <a href="https://www.marvel.com/" target="_blank"><img id="img_patrocinador" src="https://observatoriodocinema.uol.com.br/wp-content/uploads/2019/08/cropped-kevin-feige-is-now-planning-for-mcu-films-through-2025-avengers-4-title-will-speak-to-the-heart-of-the-story-social-1.jpg" width="640" height="400"></a>
        </div>
        <div>
            <h3 style="margin-top: 100px; margin-left: 50px">Jogador 1 X Jogador 2 | Criar função</h3>
        </div>
    </div>
</body>
<script>
    const audio = document.querySelector('audio')
    audio.currentTime = 0
    const screen = document.getElementById('screen')
    const tabHelper = document.getElementById('helper')
    const largura = 7
    const altura = 6
    const tabuleiro = altura * largura
    const campos = []

    for (let i = 0; i < altura * largura; i++) {
        campos[i] = 0
    }
    //setInterval(mostraTabela , 1000)
    mostraTabela(1, 1)

    function verificaDirecoes(player, X, Y) {
        verificaLargura(player, Y)
        verificaAltura(player, X)
        verificaDiagonalPrimaria(player, X, Y)
        verificaDiagonalSecundaria(player, X, Y)
        verificaCamposVazios()
    }
    function verificaCamposVazios() {
        for (let i = 0; i < campos.length; i++) {
            if (campos[i] == 0) {
                return
            }
        }
        console.log('empate')
    }

    function verificaAltura(player, X) {
        let contador = 0
        for (let i = X; i < tabuleiro; i = i + largura) {
            if (document.getElementById(i).getAttribute('player') == player) {
                contador++
            } else {
                contador = 0;
            }
            if (contador == 4) {
                audio.play();
                ApresentaMensagem(player);
                return player;
            }
        }
    }
    function verificaLargura(player, Y) {
        let contador = 0
        for (let i = Y * largura; i < (Y * largura + largura); i++) {
            if (document.getElementById(i).getAttribute('player') == player) {
                contador++
            } else {
                contador = 0;
            }
            if (contador == 4) {
                audio.play();
                ApresentaMensagem(player);
                return player;
            }
        }
    }
    function verificaDiagonalPrimaria(player, X, Y) {
        var diagonal = X - Y
        if (diagonal < 0) {
            var pontoInicial = 0 + (largura * diagonal * -1)
            var repeticao = altura + diagonal
        } else if (diagonal > 0) {
            var pontoInicial = 0 + diagonal
            var repeticao = largura - diagonal
        } else {
            var pontoInicial = 0
            var repeticao = altura
        }
        let contador = 0;
        for (let i = 0; i < repeticao; i++) {
            let indice = pontoInicial + (largura * i) + i
            var casaPlayer = document.getElementById(indice).getAttribute('player')
            if (casaPlayer == player) {
                contador++
            }
            else {
                contador = 0
            }
            if (contador == 4) {
                audio.play();
                ApresentaMensagem(player);
                return player;
            }
        }
    }
    function verificaDiagonalSecundaria(player, X, Y) {
        var diagonal = X + Y - (altura - 1)
        if (diagonal < 0) {
            var pontoInicial = tabuleiro - largura + (largura * diagonal)
            var repeticao = altura + diagonal
        } else if (diagonal > 0) {
            var pontoInicial = tabuleiro - largura + diagonal
            var repeticao = largura - diagonal
        } else {
            var pontoInicial = tabuleiro - largura
            var repeticao = altura
        }
        let contador = 0;
        for (let i = 0; i < repeticao; i++) {
            let indice = pontoInicial - (largura * i) + i
            var casaPlayer = document.getElementById(indice).getAttribute('player')
            if (casaPlayer == player) {
                contador++
            }
            else {
                contador = 0
            }
            if (contador == 4) {
                audio.play();
                ApresentaMensagem(player);
                return player;
            }
        }
    }

    function marcar(player, X) {
        if (X > largura || player == 0) {
            return false
        }
        for (let i = 0; true; i++) {
            var ultimoDaAltura = altura * largura - (largura * (i + 1)) + X
            if (ultimoDaAltura < 0) {
                return false
            }
            if (campos[ultimoDaAltura] == 0) {
                campos[ultimoDaAltura] = player == 1 ? 1 : 2;
                var Y = altura - (i + 1)
                mostraTabela(ultimoDaAltura, player == 1 ? 2 : 1)
                verificaDirecoes(player, X, Y)
                return false
            }
        }
    }

    function mostraTabela(atual, player) {
            //setInterval(mostraTabela , 1000)
        var helper = "<table><tr>";
        for (let i = 0; i < largura; i++) {
            helper += "<td class='playerActionTd'>"
            helper += "<div class='playerAction playerAction" + player + "' onClick='marcar(" + player + "," + i + ")'></div>"
            helper += "</td>"
        }
        helper += "</tr></table>"
        tabHelper.innerHTML = helper

        var html = "<table class='tabelaPrincipal'>"
        for (let i = 0; i < tabuleiro / largura; i++) {
            html += "<tr>"
            for (let j = 0; j < tabuleiro / altura; j++) {
                if (campos[i * largura + j] == 0) {
                    html += "<td> <div player='0' id='" + (i * largura + j) + "' class='white campo'></div>"
                }
                else if (campos[i * largura + j] == 1) {
                    html += "<td> <div player='1' id='" + (i * largura + j) + "' class='red campo'></div>"
                }
                else {
                    html += "<td> <div player='2' id='" + (i * largura + j) + "' class='blue campo'></div>"
                }

                html += "</td>"
            }
            html += "</tr>"
        }
        html += "</table>"
        screen.innerHTML = html

        if (atual != -1) {
            let deslocar = Math.floor(atual / largura) * 100
            document.getElementById(atual).setAttribute("style", "transform: translateY(-" + deslocar + "px);animation: peca 2s forwards'")
        }
    }
    
    //Juka implementations

    var divisao = document.querySelector('#popup');
    var acc = document.querySelector('#helper');

    function ApresentaMensagem(player) {
        divisao.style.display = 'block';
        acc.style.visibility = 'hidden';
        document.getElementById('popup').innerHTML = ("Player " + player + " é o vencedor! \n<button id='botao' onclick='window.location.reload(true)'> Jogar novamente </button> \n<button id='botao' onclick=location.href='saguao.html'> Saguão </button>");
    }
    //----------------------

</script>
<style>

    div {
        display: inline-block;
    }

    #div1 {
        width: 60vw;
        height: 100vh;
        float: left;
        padding: clamp(35px, 8%, 70px);
    }

    #div2 {
        width: 38.5vw;
        height: 100vh;
        float: left;
        padding: clamp(35px, 8%, 70px);
    }

    .playerActionTd {
        border: 0px !important;
    }

    .playerAction {
        width: 98px;
        height: 100px;
        cursor: pointer;
        border-radius: 50%;
    }

    .playerAction2:hover {
        background-image: url("https://imagensemoldes.com.br/wp-content/uploads/2020/04/Imagem-Escudo-Capit%C3%A3o-Am%C3%A9rica-PNG.png");
        background-size: 98px 100px;
        
    }

    .playerAction1:hover {
        background-image: url("https://static3.tcdn.com.br/img/img_prod/460977/capacete_eletronico_homem_de_ferro_iron_man_marvel_legends_series_hasbro_20589_1_20201211173552.jpg");
        background-size: 98px 100px;
    }

    #screen {
        margin-top: 5px;
        margin-left: 100px
    }

    #title {
        margin-top: -40px;
        margin-left: 350px;
    }

    .tabelaPrincipal {
        border: solid 1px black;
        width: 700px;
        height: 600px;
        background-size: 700px 600px;
        background-image: url("https://cdn.ome.lt/42GZQPInUNFKS4wAkk1_s6yViKU=/1200x630/smart/extras/conteudos/fortnite-x-marvel-zero-war-announcement-article-card_S0F5i0s.jpg");
    }

    @keyframes peca {
        to {
            transform: translateY(0);
        }
    }

    td {
        border: solid 1px black;
        background-color: white;
        text-align: center;
        border-radius: 50%;
        padding: 0;
    }

    .campo {
        border-radius: 50%;
        animation: peca 1s forwards;
        text-align: center;
        width: 100%;
        height: 100%;
        border-collapse: collapse;
    }

    .white {
        background-color: white;
    }

    .red {
        background-image: url("https://static3.tcdn.com.br/img/img_prod/460977/capacete_eletronico_homem_de_ferro_iron_man_marvel_legends_series_hasbro_20589_1_20201211173552.jpg");
        background-size: 98px 100px;
    }

    .blue {
        background-image: url("https://imagensemoldes.com.br/wp-content/uploads/2020/04/Imagem-Escudo-Capit%C3%A3o-Am%C3%A9rica-PNG.png");
        background-size: 98px 100px;
        
    }

    #popup {
        width: 100%;
        top: 0;
        left: 35px;
        background-color: rgb(107, 99, 99);
        color: rgb(0, 0, 0);
        position: absolute;
        display: none;
        text-align: center;
        border-radius: 20px;
        padding: 20px;
    }

    #botao {
        width: 100%;
        align-items: center;
        justify-content: center;
        height: 35px;
        border-radius: 25px;
        cursor: pointer;
        border: 0.1px solid black;
    }

    #bloco {
        width: 200px;
        height: 70px;
        top: 50%;
        left: 50%;
        margin-top: -100px;
        margin-left: -100px;
        position: absolute;
    }

    #button_game_back {
    width: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 35px;
    border-radius: 5px;
    cursor: pointer;
    border: none;
    margin-left: 300px;
    margin-top: -370px;
    }

    #img_patrocinador {
        border: 5px solid black;
        margin-left: -100px;
        margin-top: -240px;
    }

</style>

</html>